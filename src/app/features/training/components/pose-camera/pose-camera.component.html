<!-- src/app/features/training/components/pose-camera/pose-camera.component.html -->
<!-- ‚úÖ TEMPLATE PROFESIONAL COMPLETO -->

<div class="camera-container">
  
  <!-- üîÑ ESTADO DE CARGA -->
  <div class="loading-overlay" *ngIf="isLoading">
    <div class="loading-spinner"></div>
    <div class="loading-text">Iniciando c√°mara...</div>
    <div class="loading-subtitle" *ngIf="initializationAttempts > 0">
      Intento {{ initializationAttempts }} de {{ maxInitializationAttempts }}
    </div>
  </div>

  <!-- ‚ùå ESTADO DE ERROR -->
  <div class="error-overlay" *ngIf="error && !isLoading">
    <div class="error-icon">üì∑</div>
    <div class="error-title">Error de Inicializaci√≥n</div>
    <div class="error-message">{{ error }}</div>
    <button class="retry-button" (click)="startCamera()">
      REINTENTAR
    </button>
  </div>

  <!-- ‚úÖ ELEMENTOS DE C√ÅMARA - SIEMPRE PRESENTES PARA VIEWCHILD STATIC -->
  <div class="camera-content" 
       [style.display]="(!isLoading && !error && isInitialized) ? 'block' : 'none'">
    
    <!-- üìπ VIDEO - SIEMPRE EN DOM -->
    <video 
      #videoElement 
      class="video-element"
      autoplay 
      muted 
      playsinline>
    </video>
    
    <!-- üé® CANVAS - SIEMPRE EN DOM -->
    <canvas 
      #canvasElement 
      class="canvas-element">
    </canvas>
    
    <!-- üéØ OVERLAY - SIEMPRE EN DOM -->
    <canvas 
      #overlayElement 
      class="overlay-element">
    </canvas>
    
  </div>

  <!-- üé® UI PROFESIONAL - SOLO CUANDO EST√Å ACTIVO -->
  <div class="ui-overlay" *ngIf="!isLoading && !error && isInitialized">
    
    <!-- üìä PANEL DE ESTAD√çSTICAS COMPACTO -->
    <div class="stats-panel" *ngIf="fps > 0">
      <div class="stats-header">
        <div class="stats-title">
          <ion-icon name="analytics-outline"></ion-icon>
          <span>Estad√≠sticas en Vivo</span>
        </div>
        <div class="connection-indicator" [ngClass]="fps > 20 ? 'connected' : 'poor'">
          <div class="pulse-dot"></div>
          <span>{{ fps > 20 ? 'Excelente' : 'Conectando' }}</span>
        </div>
      </div>
      
      <div class="stats-grid">
        <div class="stat-card">
          <ion-icon name="speedometer-outline"></ion-icon>
          <div class="stat-value">{{ fps }}</div>
          <div class="stat-label">FPS</div>
        </div>
        
        <div class="stat-card">
          <ion-icon name="fitness-outline"></ion-icon>
          <div class="stat-value">{{ repetitionCount }}</div>
          <div class="stat-label">REPS</div>
        </div>
        
        <div class="stat-card">
          <ion-icon name="trophy-outline"></ion-icon>
          <div class="stat-value" [ngClass]="getQualityClass()">{{ currentQuality }}%</div>
          <div class="stat-label">CALIDAD</div>
        </div>
        
        <div class="stat-card">
          <ion-icon name="pulse-outline"></ion-icon>
          <div class="stat-value">{{ getPhaseText() }}</div>
          <div class="stat-label">FASE</div>
        </div>
      </div>
      
      <div class="progress-bar" *ngIf="repetitionCount > 0">
        <div class="progress-fill" [style.width.%]="Math.min(repetitionCount * 10, 100)"></div>
      </div>
    </div>
    
<!-- üîô BOT√ìN DE RETROCESO EN ESQUINA SUPERIOR -->
<div class="back-button-container">
  <button class="back-btn-top" (click)="goBackToExercises()">
    <div class="back-icon">
      <ion-icon name="arrow-back"></ion-icon>
    </div>
    <span>Volver</span>
  </button>
</div>

<!-- üéÆ CONTROLES PROFESIONALES -->
<div class="professional-controls">
  
  <div class="control-group">
    
    <!-- Bot√≥n Esqueleto -->
    <button class="pro-control-btn skeleton-btn" 
            (click)="toggleSkeleton()"
            [class.active]="showSkeleton">
      <div class="btn-icon">
        <ion-icon [name]="showSkeleton ? 'eye' : 'eye-off'"></ion-icon>
      </div>
      <div class="btn-label">Esqueleto</div>
      <div class="btn-indicator" [class.on]="showSkeleton"></div>
    </button>
    
    <!-- Bot√≥n Reset -->
    <button class="pro-control-btn reset-btn" (click)="resetSession()">
      <div class="btn-icon">
        <ion-icon name="refresh-outline"></ion-icon>
      </div>
      <div class="btn-label">Reiniciar</div>
    </button>
    
    <!-- Bot√≥n Pausa/Play -->
    <button class="pro-control-btn pause-btn" (click)="togglePause()">
      <div class="btn-icon">
        <ion-icon [name]="isPaused ? 'play' : 'pause'"></ion-icon>
      </div>
      <div class="btn-label">{{ isPaused ? 'Continuar' : 'Pausar' }}</div>
    </button>
    
    <!-- Bot√≥n Configuraci√≥n -->
    <button class="pro-control-btn settings-btn" (click)="showSettings()">
      <div class="btn-icon">
        <ion-icon name="settings-outline"></ion-icon>
      </div>
      <div class="btn-label">Ajustes</div>
    </button>
    
  </div>
  
  <!-- Bot√≥n de Finalizar Sesi√≥n -->
  <button class="exit-btn" (click)="stopCamera()">
    <div class="exit-icon">
      <ion-icon name="close"></ion-icon>
    </div>
    <span>Finalizar Sesi√≥n</span>
  </button>
</div>
    <!-- ‚ö†Ô∏è ALERTAS DE ERRORES MEJORADAS -->
    <div class="error-notifications" *ngIf="currentErrors.length > 0">
      <div *ngFor="let error of currentErrors.slice(0, 2); trackBy: trackByErrorType" 
           class="error-notification"
           [ngClass]="'severity-' + error.severity">
        <div class="error-icon">
          <ion-icon name="warning"></ion-icon>
        </div>
        <div class="error-content">
          <div class="error-title">Correcci√≥n de Postura</div>
          <div class="error-message">{{ error.description }}</div>
          <div class="error-recommendation">üí° {{ error.recommendation }}</div>
        </div>
        <div class="error-severity">
          <div class="severity-indicator" [style.width.%]="error.severity * 10"></div>
        </div>
      </div>
    </div>
    
    <!-- üéØ OBJETIVO DE REPETICIONES -->
    <div class="rep-target" *ngIf="repetitionCount > 0">
      <div class="target-circle">
        <svg width="80" height="80" class="target-progress">
          <circle cx="40" cy="40" r="35" 
                  stroke="rgba(255,255,255,0.2)" 
                  stroke-width="3" 
                  fill="none"/>
          <circle cx="40" cy="40" r="35" 
                  stroke="#00d4ff" 
                  stroke-width="3" 
                  fill="none"
                  stroke-linecap="round"
                  [style.stroke-dasharray]="getCircleProgress()"
                  style="transform: rotate(-90deg); transform-origin: center;"/>
        </svg>
        <div class="target-content">
          <div class="target-number">{{ repetitionCount }}</div>
          <div class="target-label">/ 10</div>
        </div>
      </div>
    </div>
    
  </div>

</div>
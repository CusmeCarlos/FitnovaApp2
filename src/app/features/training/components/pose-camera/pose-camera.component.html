<!-- src/app/features/training/components/pose-camera/pose-camera.component.html -->
<!-- ‚úÖ LAYOUT ERGON√ìMICO Y LIMPIO -->

<div class="camera-container">
  
  <!-- üîÑ ESTADO DE CARGA -->
  <div class="loading-overlay" *ngIf="isLoading">
    <div class="loading-spinner">
      <ion-spinner name="crescent" color="primary"></ion-spinner>
    </div>
    <div class="loading-text">{{ getStatusMessage() }}</div>
    <div class="loading-subtitle" *ngIf="initializationAttempts > 0">
      Intento {{ initializationAttempts }} de {{ maxInitializationAttempts }}
    </div>
  </div>

  <!-- ‚ùå ESTADO DE ERROR -->
  <div class="error-overlay" *ngIf="error && !isLoading">
    <div class="error-content">
      <ion-icon name="camera-outline" class="error-icon"></ion-icon>
      <div class="error-title">Error de Inicializaci√≥n</div>
      <div class="error-message">{{ error }}</div>
      <ion-button 
        class="retry-button" 
        fill="solid" 
        color="primary"
        (click)="restartCamera()">
        <ion-icon name="refresh-outline" slot="start"></ion-icon>
        REINTENTAR
      </ion-button>
    </div>
  </div>

  <!-- ============================================ -->
  <!-- ‚úÖ ELEMENTOS DE C√ÅMARA Y CANVAS -->
  <!-- ============================================ -->
  <div class="camera-content" [class.hidden]="isLoading || !!error">
    
    <!-- üìπ VIDEO DE C√ÅMARA -->
    <video 
      #videoElement
      class="camera-video"
      autoplay 
      muted 
      playsinline>
    </video>

    <!-- üö¶ CANVAS PARA ESTADOS DE PREPARACI√ìN -->
    <canvas 
      #readinessCanvas
      class="readiness-notification-canvas">
    </canvas>

    <!-- üö® CANVAS PARA ALERTAS DE ERROR -->
    <canvas 
      #overlayElement
      class="error-alert-canvas">
    </canvas>

    <!-- üé® CANVAS PARA ESQUELETO -->
    <canvas 
      #canvasElement
      class="skeleton-canvas"
      [class.hidden]="!showSkeleton">
    </canvas>

  </div>

  <!-- ============================================ -->
  <!-- üí™ PANEL DE INFORMACI√ìN - SUPERIOR IZQUIERDO -->
  <!-- ============================================ -->
  <div class="info-panel" *ngIf="isInitialized && !isLoading" [class.hidden]="!showUI">
    
    <!-- Informaci√≥n de ejercicio -->
    <div class="exercise-info">
      <div class="exercise-name">
        {{ getExerciseName() }}
      </div>
      <div class="exercise-phase" [class]="'phase-' + currentPhase.toLowerCase()">
        {{ getPhaseText() }}
      </div>
    </div>

    <!-- Contador de repeticiones -->
    <div class="repetition-counter">
      <div class="counter-label">Repeticiones</div>
      <div class="counter-value">{{ repetitionCount }}</div>
    </div>

    <!-- Puntuaci√≥n de calidad -->
    <div class="quality-score" *ngIf="currentQualityScore > 0">
      <div class="score-label">Calidad</div>
      <div class="score-value" [class]="getQualityClass()">
        {{ currentQualityScore }}%
      </div>
    </div>

    <!-- FPS -->
    <div class="fps-indicator">
      <ion-icon name="speedometer-outline"></ion-icon>
      {{ fps }} FPS
    </div>

  </div>

  <!-- ============================================ -->
  <!-- üéÆ CONTROLES - CENTRO ABAJO -->
  <!-- ============================================ -->
  <div class="controls-panel" *ngIf="!isLoading && !error" [class.hidden]="!showUI">
    
    <!-- Toggle Skeleton -->
    <ion-button 
      fill="solid"
      (click)="toggleSkeleton()"
      [class.active]="showSkeleton">
      <ion-icon 
        [name]="showSkeleton ? 'body' : 'body-outline'"
        slot="icon-only">
      </ion-icon>
    </ion-button>

    <!-- Toggle Error Detection -->
    <ion-button 
      fill="solid"
      (click)="toggleErrorDetection()"
      [class.active]="enableErrorDetection">
      <ion-icon 
        [name]="enableErrorDetection ? 'shield-checkmark' : 'shield-checkmark-outline'"
        slot="icon-only">
      </ion-icon>
    </ion-button>

    <!-- Toggle Audio -->
    <ion-button 
      fill="solid"
      (click)="toggleAudio()"
      [class.active]="enableAudio">
      <ion-icon 
        [name]="enableAudio ? 'volume-high' : 'volume-mute'"
        slot="icon-only">
      </ion-icon>
    </ion-button>

  </div>

  <!-- ============================================ -->
  <!-- üëÅÔ∏è BOT√ìN TOGGLE UI - ESQUINA INFERIOR DERECHA -->
  <!-- ============================================ -->
  <ion-button 
    class="toggle-ui-btn"
    [class.ui-hidden]="!showUI"
    fill="solid"
    (click)="toggleUI()"
    *ngIf="!isLoading && !error">
    <ion-icon 
      [name]="showUI ? 'eye' : 'eye-off'"
      slot="icon-only">
    </ion-icon>
  </ion-button>

  <!-- ============================================ -->
  <!-- üé§ INDICADOR DE AUDIO (OPCIONAL) -->
  <!-- ============================================ -->
  <div class="audio-indicator" *ngIf="isPlayingAudio && showUI">
    <ion-icon name="volume-high-outline" class="pulse"></ion-icon>
    <span>Audio</span>
  </div>

</div>
<!-- src/app/features/training/components/pose-camera/pose-camera.component.html -->
<!-- ‚úÖ TEMPLATE COMPLETO CON INDICADORES VISUALES -->

<div class="camera-container">
  
  <!-- üîÑ ESTADO DE CARGA -->
  <div class="loading-overlay" *ngIf="isLoading">
    <div class="loading-spinner">
      <ion-spinner name="crescent" color="primary"></ion-spinner>
    </div>
    <div class="loading-text">{{ getStatusMessage() }}</div>
    <div class="loading-subtitle" *ngIf="initializationAttempts > 0">
      Intento {{ initializationAttempts }} de {{ maxInitializationAttempts }}
    </div>
  </div>

  <!-- ‚ùå ESTADO DE ERROR -->
  <div class="error-overlay" *ngIf="error && !isLoading">
    <div class="error-content">
      <ion-icon name="camera-outline" class="error-icon"></ion-icon>
      <div class="error-title">Error de Inicializaci√≥n</div>
      <div class="error-message">{{ error }}</div>
      <ion-button 
        class="retry-button" 
        fill="solid" 
        color="primary"
        (click)="restartCamera()">
        <ion-icon name="refresh-outline" slot="start"></ion-icon>
        REINTENTAR
      </ion-button>
    </div>
  </div>

  <!-- ‚úÖ ELEMENTOS DE C√ÅMARA -->
  <div class="camera-content" [class.hidden]="isLoading || !!error">
    
    <!-- üìπ VIDEO DE C√ÅMARA -->
    <video 
      #videoElement
      class="camera-video"
      autoplay 
      muted 
      playsinline>
    </video>

    <!-- üö¶ CANVAS PARA ESTADOS DE PREPARACI√ìN (LATERAL) -->
    <canvas 
      #readinessCanvas
      class="readiness-notification-canvas">
    </canvas>
    <!-- üö® CANVAS PARA ALERTAS DE ERROR (SUPERIOR) -->
      <canvas 
      #overlayElement
      class="error-alert-canvas">
      </canvas>
    <!-- üé® CANVAS PARA ESQUELETO (33 PUNTOS) -->
    <canvas 
      #canvasElement
      class="skeleton-canvas"
      [class.hidden]="!showSkeleton">
    </canvas>

    <!-- üö® CANVAS UNIFICADO PARA TODAS LAS ALERTAS -->
    <!-- ‚úÖ ESTE ES EL √öNICO SISTEMA DE ALERTAS AHORA -->
    <canvas 
      #overlayElement
      class="unified-alert-canvas">
    </canvas>

  </div>
   <!-- ========================================== -->
  <!-- ‚úÖ PANEL DE INFORMACI√ìN (NO ALERTAS) -->
  <!-- ========================================== -->
  
  <!-- üìä STATS SUPERIORES - Solo informaci√≥n, NO alertas -->
  <div class="stats-panel" *ngIf="!isLoading && !error">
    <div class="stat-item">
      <ion-icon name="fitness-outline"></ion-icon>
      <span>{{ getExerciseName() }}</span>
    </div>
    <div class="stat-item">
      <ion-icon name="repeat-outline"></ion-icon>
      <span>{{ repetitionCount }}</span>
    </div>
    <div class="stat-item">
      <ion-icon name="speedometer-outline"></ion-icon>
      <span>{{ fps }} FPS</span>
    </div>
  </div>

  <!-- üìä PANEL DE INFORMACI√ìN -->
  <div class="info-panel" *ngIf="isInitialized && !isLoading">
    
    <!-- üèÉ INFORMACI√ìN DE EJERCICIO -->
    <div class="exercise-info">
      <div class="exercise-name">
        {{ getExerciseName() }}
      </div>
      <div class="exercise-phase" [class]="'phase-' + currentPhase.toLowerCase()">
        {{ getPhaseText() }}
      </div>
    </div>

    <!-- üî¢ CONTADOR DE REPETICIONES -->
    <div class="repetition-counter">
      <div class="counter-label">Repeticiones</div>
      <div class="counter-value">{{ repetitionCount }}</div>
    </div>

    <!-- üìà PUNTUACI√ìN DE CALIDAD -->
    <div class="quality-score" *ngIf="currentQualityScore > 0">
      <div class="score-label">Calidad</div>
      <div class="score-value" [class]="getQualityClass()">
        {{ currentQualityScore }}%
      </div>
    </div>

    <!-- üìä FPS -->
    <div class="fps-indicator">
      <ion-icon name="speedometer-outline"></ion-icon>
      {{ fps }} FPS
    </div>

  </div>

    <!-- üéÆ CONTROLES INFERIORES -->
    <div class="controls-panel" *ngIf="!isLoading && !error">
    
      <ion-button 
        fill="clear" 
        size="small"
        (click)="toggleSkeleton()"
        [class.active]="showSkeleton">
        <ion-icon 
          [name]="showSkeleton ? 'eye' : 'eye-off'" 
          slot="icon-only">
        </ion-icon>
      </ion-button>
  
      <ion-button 
        fill="clear" 
        size="small"
        (click)="toggleErrorDetection()"
        [class.active]="enableErrorDetection">
        <ion-icon 
          [name]="enableErrorDetection ? 'shield-checkmark' : 'shield-outline'" 
          slot="icon-only">
        </ion-icon>
      </ion-button>
  
      <ion-button 
        fill="clear" 
        size="small"
        (click)="toggleAudio()"
        [class.active]="enableAudio">
        <ion-icon 
          [name]="enableAudio ? 'volume-high' : 'volume-mute'" 
          slot="icon-only">
        </ion-icon>
      </ion-button>

    <!-- ‚èπÔ∏è PARAR C√ÅMARA -->
    <ion-button 
      fill="clear" 
      size="small"
      color="danger"
      (click)="stopCamera()">
      <ion-icon name="stop-outline" slot="icon-only"></ion-icon>
    </ion-button>

  </div>

  <div class="audio-indicator" *ngIf="isPlayingAudio">
    <ion-icon name="volume-high-outline" class="pulse"></ion-icon>
    <span>Audio</span>
  </div>

</div>
<!-- src/app/features/training/components/pose-camera/pose-camera.component.html -->
<!-- âœ… VERSIÃ“N CON BOTÃ“N STOP PROMINENTE -->

<div class="camera-container">

  <!-- ============================================ -->
  <!-- ðŸ”´ BOTÃ“N STOP - SUPERIOR DERECHO (SIEMPRE VISIBLE) -->
  <!-- ============================================ -->
  <ion-button 
    class="stop-button"
    fill="solid"
    color="danger"
    (click)="stopTraining()"
    *ngIf="isInitialized && !isLoading && !error">
    <ion-icon name="stop-circle" slot="start"></ion-icon>
    <span>DETENER</span>
  </ion-button>

  <!-- ============================================ -->
  <!-- â³ PANTALLA DE CARGA -->
  <!-- ============================================ -->
  <div class="loading-overlay" *ngIf="isLoading && !error">
    <ion-spinner name="crescent" color="primary"></ion-spinner>
    <p class="loading-text">{{ getStatusMessage() }}</p>
    <p class="loading-subtext">Intento {{ initializationAttempts }} de {{ maxInitializationAttempts }}</p>
  </div>

  <!-- ============================================ -->
  <!-- âŒ PANTALLA DE ERROR -->
  <!-- ============================================ -->
  <div class="error-overlay" *ngIf="error && !isLoading">
    <ion-icon name="alert-circle" color="danger"></ion-icon>
    <p class="error-text">{{ error }}</p>
    <ion-button fill="outline" (click)="restartCamera()">
      <ion-icon name="refresh" slot="start"></ion-icon>
      Reintentar
    </ion-button>
  </div>

  <!-- ============================================ -->
  <!-- ðŸ“¹ CONTENIDO DE CÃMARA -->
  <!-- ============================================ -->
  <div class="camera-content" [class.hidden]="isLoading || !!error">
    
    <!-- ðŸ“¹ VIDEO DE CÃMARA -->
    <video 
      #videoElement
      class="camera-video"
      autoplay 
      muted 
      playsinline>
    </video>

    <!-- ðŸš¦ CANVAS PARA ESTADOS DE PREPARACIÃ“N -->
    <canvas 
      #readinessCanvas
      class="readiness-notification-canvas">
    </canvas>

    <!-- ðŸš¨ CANVAS PARA ALERTAS DE ERROR -->
    <canvas 
      #overlayElement
      class="error-alert-canvas">
    </canvas>

    <!-- ðŸŽ¨ CANVAS PARA ESQUELETO -->
    <canvas 
      #canvasElement
      class="skeleton-canvas"
      [class.hidden]="!showSkeleton">
    </canvas>

  </div>

  <!-- ============================================ -->
  <!-- ðŸ’ª PANEL DE INFORMACIÃ“N - SUPERIOR IZQUIERDO -->
  <!-- ============================================ -->
  <div class="info-panel" *ngIf="isInitialized && !isLoading" [class.hidden]="!showUI">
    
    <!-- InformaciÃ³n de ejercicio -->
    <div class="exercise-info">
      <div class="exercise-name">
        {{ getExerciseName() }}
      </div>
      <div class="exercise-phase" [class]="'phase-' + currentPhase.toLowerCase()">
        {{ getPhaseText() }}
      </div>
    </div>

    <!-- Contador de repeticiones -->
    <div class="repetition-counter">
      <div class="counter-label">Repeticiones</div>
      <div class="counter-value">{{ repetitionCount }}</div>
    </div>

    <!-- PuntuaciÃ³n de calidad -->
    <div class="quality-score" *ngIf="currentQualityScore > 0">
      <div class="score-label">Calidad</div>
      <div class="score-value" [class]="getQualityClass()">
        {{ currentQualityScore }}%
      </div>
    </div>

    <!-- FPS -->
    <div class="fps-indicator">
      <ion-icon name="speedometer-outline"></ion-icon>
      {{ fps }} FPS
    </div>

  </div>

  <!-- ============================================ -->
  <!-- ðŸŽ® CONTROLES - CENTRO ABAJO -->
  <!-- ============================================ -->
  <div class="controls-panel" *ngIf="!isLoading && !error" [class.hidden]="!showUI">
    
    <!-- Toggle Skeleton -->
    <ion-button 
      fill="solid"
      (click)="toggleSkeleton()"
      [class.active]="showSkeleton">
      <ion-icon 
        [name]="showSkeleton ? 'body' : 'body-outline'"
        slot="icon-only">
      </ion-icon>
    </ion-button>

    <!-- Toggle Error Detection -->
    <ion-button 
      fill="solid"
      (click)="toggleErrorDetection()"
      [class.active]="enableErrorDetection">
      <ion-icon 
        [name]="enableErrorDetection ? 'shield-checkmark' : 'shield-checkmark-outline'"
        slot="icon-only">
      </ion-icon>
    </ion-button>

    <!-- Toggle Audio -->
    <ion-button 
      fill="solid"
      (click)="toggleAudio()"
      [class.active]="enableAudio">
      <ion-icon 
        [name]="enableAudio ? 'volume-high' : 'volume-mute'"
        slot="icon-only">
      </ion-icon>
    </ion-button>

  </div>

  <!-- ============================================ -->
  <!-- ðŸ‘ï¸ BOTÃ“N TOGGLE UI - ESQUINA INFERIOR DERECHA -->
  <!-- ============================================ -->
  <ion-button 
    class="toggle-ui-btn"
    [class.ui-hidden]="!showUI"
    fill="solid"
    (click)="toggleUI()"
    *ngIf="!isLoading && !error">
    <ion-icon 
      [name]="showUI ? 'eye' : 'eye-off'"
      slot="icon-only">
    </ion-icon>
  </ion-button>

  <!-- ============================================ -->
  <!-- ðŸŽ¤ INDICADOR DE AUDIO (OPCIONAL) -->
  <!-- ============================================ -->
  <div class="audio-indicator" *ngIf="isPlayingAudio && showUI">
    <ion-icon name="volume-high-outline" class="pulse"></ion-icon>
    <span>Audio</span>
  </div>

</div>
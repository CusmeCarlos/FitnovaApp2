<!-- src/app/tab2/tab2.page.html -->
<!-- üé® TAB2 ENTRENAMIENTO - HTML ULTRA PREMIUM ESTILO FINZENAPP -->
<!-- ‚úÖ SOLO DISE√ëO MEJORADO - FUNCIONALIDAD 100% INTACTA -->

<ion-header [translucent]="true" *ngIf="!showCamera">
  <ion-toolbar class="custom-toolbar">
    <ion-title class="custom-title">Entrenamiento IA</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="training-content">
  <!-- üåå Background overlay con efectos premium -->
  <div class="background-overlay" [class.training-active]="showCamera"></div>
  
  <!-- üì± VISTA SELECCI√ìN DE EJERCICIO -->
  <div class="exercise-selection" *ngIf="!showCamera">
    
    <!-- üëã SECCI√ìN BIENVENIDA ULTRA PREMIUM -->
    <div class="welcome-section" *ngIf="user">
      <div class="welcome-content">
        <div class="user-avatar">
          <img *ngIf="user.photoURL" [src]="user.photoURL" [alt]="user.displayName">
          <div *ngIf="!user.photoURL" class="avatar-placeholder">
            <ion-icon name="person"></ion-icon>
          </div>
        </div>
        <div class="welcome-text">
          <h1 class="welcome-title">¬°Hola, {{ user.displayName }}!</h1>
          <p class="welcome-subtitle">Selecciona un ejercicio para comenzar tu entrenamiento con IA</p>
          <div class="ai-badge">
            <ion-icon name="hardware-chip-outline"></ion-icon>
            <span>POWERED BY AI</span>
          </div>
        </div>
      </div>
    </div>

    <!-- üìä ESTAD√çSTICAS DEL D√çA - ULTRA PREMIUM -->
    <div class="stats-card-enhanced">
      <div class="stats-header">
        <h3 class="stats-title">
          <ion-icon name="today-outline"></ion-icon>
          Estad√≠sticas de Hoy
        </h3>
        <div class="stats-date">Hoy</div>
      </div>
      
      <div class="stats-grid-enhanced">
        <!-- Tiempo -->
        <div class="stat-item-enhanced">
          <div class="stat-icon-enhanced">
            <ion-icon name="time-outline"></ion-icon>
          </div>
          <div class="stat-content">
            <span class="stat-label-enhanced">Tiempo</span>
            <span class="stat-value-enhanced">{{ todayStats.duration }}</span>
          </div>
        </div>

        <!-- Repeticiones -->
        <div class="stat-item-enhanced">
          <div class="stat-icon-enhanced">
            <ion-icon name="fitness-outline"></ion-icon>
          </div>
          <div class="stat-content">
            <span class="stat-label-enhanced">Repeticiones</span>
            <span class="stat-value-enhanced">{{ todayStats.repetitions }}</span>
          </div>
        </div>

        <!-- Sugerencias -->
        <div class="stat-item-enhanced">
          <div class="stat-icon-enhanced">
            <ion-icon name="bulb-outline"></ion-icon>
          </div>
          <div class="stat-content">
            <span class="stat-label-enhanced">Sugerencias</span>
            <span class="stat-value-enhanced">{{ todayStats.suggestions }}</span>
          </div>
        </div>

        <!-- Correcciones -->
        <div class="stat-item-enhanced">
          <div class="stat-icon-enhanced">
            <ion-icon name="checkmark-circle-outline"></ion-icon>
          </div>
          <div class="stat-content">
            <span class="stat-label-enhanced">Correcciones</span>
            <span class="stat-value-enhanced">{{ todayStats.corrections }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- üèãÔ∏è SECCI√ìN EJERCICIOS - ULTRA PREMIUM -->
    <div class="exercises-section">
      <div class="section-header">
        <h3 class="section-title">
          <ion-icon name="barbell-outline"></ion-icon>
          Ejercicios Disponibles
        </h3>
        <p class="section-subtitle">Selecciona tu entrenamiento favorito con an√°lisis postural en tiempo real</p>
      </div>

      <div class="exercises-grid-enhanced">
        <div class="exercise-card" 
             *ngFor="let exercise of availableExercises"
             [class.selected]="exercise.type === currentExercise"
             (click)="selectExercise(exercise.type)">
          
          <div class="exercise-header">
            <!-- Icono del ejercicio -->
            <div class="exercise-icon-wrapper">
              <ion-icon [name]="exercise.icon" class="exercise-icon"></ion-icon>
            </div>

            <!-- Badge de dificultad -->
            <span class="difficulty-badge" 
                  [class.beginner]="exercise.difficulty === 'Principiante'"
                  [class.intermediate]="exercise.difficulty === 'Intermedio'"
                  [class.advanced]="exercise.difficulty === 'Avanzado'">
              {{ exercise.difficulty }}
            </span>

            <!-- Badge de seleccionado -->
            <div class="selected-badge">
              <ion-icon name="checkmark"></ion-icon>
            </div>
          </div>

          <div class="exercise-body">
            <h4 class="exercise-name">{{ exercise.name }}</h4>
            <p class="exercise-description">{{ exercise.description }}</p>
            
            <div class="exercise-meta">
              <div class="meta-item">
                <ion-icon name="flash-outline"></ion-icon>
                <span>IA Activa</span>
              </div>
              <div class="meta-item">
                <ion-icon name="eye-outline"></ion-icon>
                <span>Tiempo Real</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ‚öôÔ∏è CONFIGURACIONES - ULTRA PREMIUM -->
    <div class="settings-section">
      <div class="section-header">
        <h3 class="section-title">
          <ion-icon name="options-outline"></ion-icon>
          Configuraciones
        </h3>
        <p class="section-subtitle">Personaliza tu experiencia de entrenamiento</p>
      </div>

      <div class="settings-grid">
        <!-- Audio -->
        <div class="setting-item" (click)="toggleAudio()">
          <div class="setting-info">
            <div class="setting-icon">
              <ion-icon name="volume-high-outline"></ion-icon>
            </div>
            <div class="setting-text">
              <p class="setting-label">Audio</p>
              <p class="setting-description">Retroalimentaci√≥n por voz</p>
            </div>
          </div>
          <ion-toggle [checked]="audioEnabled" (ionChange)="toggleAudio()"></ion-toggle>
        </div>

        <!-- Detecci√≥n IA -->
        <div class="setting-item" (click)="toggleDetection()">
          <div class="setting-info">
            <div class="setting-icon">
              <ion-icon name="scan-outline"></ion-icon>
            </div>
            <div class="setting-text">
              <p class="setting-label">Detecci√≥n IA</p>
              <p class="setting-description">An√°lisis postural autom√°tico</p>
            </div>
          </div>
          <ion-toggle [checked]="detectionEnabled" (ionChange)="toggleDetection()"></ion-toggle>
        </div>

        <!-- Esqueleto Visual -->
        <div class="setting-item" (click)="toggleSkeleton()">
          <div class="setting-info">
            <div class="setting-icon">
              <ion-icon name="body-outline"></ion-icon>
            </div>
            <div class="setting-text">
              <p class="setting-label">Esqueleto Visual</p>
              <p class="setting-description">Mostrar puntos corporales</p>
            </div>
          </div>
          <ion-toggle [checked]="skeletonVisible" (ionChange)="toggleSkeleton()"></ion-toggle>
        </div>
      </div>
    </div>

    <!-- üöÄ BOT√ìN INICIAR ENTRENAMIENTO - ULTRA PREMIUM -->
    <div class="start-training-section">
      <ion-button 
        expand="block" 
        size="large"
        class="start-button-premium"
        [disabled]="!currentExercise"
        (click)="startTraining()">
        <ion-icon name="play-circle-outline"></ion-icon>
        Iniciar {{ getExerciseName() }}
      </ion-button>

      <!-- Tips premium -->
      <div class="training-tips">
        <div class="tip-item">
          <ion-icon name="bulb-outline"></ion-icon>
          <span>Mant√©n buena iluminaci√≥n para mejor detecci√≥n</span>
        </div>
        <div class="tip-item">
          <ion-icon name="body-outline"></ion-icon>
          <span>Col√≥cate de frente a la c√°mara</span>
        </div>
        <div class="tip-item">
          <ion-icon name="shield-checkmark-outline"></ion-icon>
          <span>La IA corregir√° tu postura en tiempo real</span>
        </div>
      </div>
    </div>
  </div>

  <!-- üìπ VISTA C√ÅMARA ACTIVA (cuando showCamera === true) -->
  <div class="camera-view" *ngIf="showCamera">
    <app-pose-camera
      [exerciseType]="currentExercise"
      [enableAudio]="audioEnabled"
      [enableErrorDetection]="detectionEnabled"
      [showSkeleton]="skeletonVisible"
      (repetitionCounted)="onRepetitionCounted($event)"
      (errorDetected)="onErrorDetected($event)"
      (trainingStopped)="stopTraining()">
    </app-pose-camera>
  </div>
</ion-content>